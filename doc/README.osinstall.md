# Recipes for Installing Operating systems

# Installer and the "Recipe"

In a traditional manual install installer presents dozens of manual prompts
requiring test entry, selection from options and checking radio and check boxes
on text console based or graphical GUI during the installation.
The OS install recipe aims to provide the answers to most or all of the
questions and prompts presented by installer. By providing partial answers,
the installer will still pop up UI for the unanswered questions.
By providing all the answers, you can achieve a 100% unattended / automated install (which is very likely the
reason you want to use lineboot).

Some of the recipe provided hints and directives may not be solely answers
to installer questions, but be targeted for advanced customization of installation
(not only basic install information that installer promps for).

In linetboot the OS install recipes are dynamically generated by templating using parameters from multiple sources:

- User: JSON file given by inst.userconfig (for initial non-root user to create on host)
- Network settings: Network settings from main config "net" section overriden by settings from recorded host facts
- Misc settings from "inst" (OS Installation section): locatization, timezone, running post-install script


# Pre and Post Operations

Installers and their recipe formats usually allow running a script or any executable before the main installer runs and also similarly running an
executable after installer has completed it's job.
These are called pre and post operartions (or scrips or hooks).

These customizable scripting solutions are a powerful mechanism to compensate for the shortcomings of installer out-of-box functionality and bugs.

# Creating Recipes

Creating recipes for automated operating installation can be tedious,
especially if ignoring existing working examples (from internet, distro exaples) or relying too much on "just read the documentation". This is componded by:

- Recipe formats and directives changing with new versions of installers
- New directives getting introduced and deprecated quickly (making them only
work with narrow set of installer versions)
- Documentation being specific to one very particular version of installer and recipe format.
- Challenges debugging (esp. interactively) the recipe based problems and errors during installation
- Recipe formats not being accurately versioned and documented as declared working with particular version of installer
- Various bugs in (particular version) of installer

<!-- Illustrate host-recipe interaction -->

![Recipe Creation](doc/recipegen.png "Recipe Creation Illustrated")

# Solutions for Recipe based Automation

- Use "stable" and long-time supported directives and constructs in your recipes
- Leave advanced customization parts of final installation to "post OS install" part of the installation
  - Run bare minimum customization as part of OS install (while still providing enough "answers" to keep install automated)
  - Run majority of customization in a post operation script
  - Let installation finish, let the host reboot and run a remote (or local) provisioning operation
    (SSH commands, shell script, ansible, chef or puppet "play") to update and add configurations

# Setting Up The Network

Setting up network is challenging especially if your host during PXE (DHCP) phase does not get correct final network
information (e.g. correct IP address, correct gateway, netmask, etc).

Part of the solution to these problems is to have DHCP server always provide the correct, final network settings from
the very beginning of install. On static IP address machines this means associating the host MAC address to a fixed IP address at the DHCP server.

# Configuring the Disk Partitioning and Partition Allocation

Most installers in their recipe formats seem to be unable to configure existing partitions to be used for the installation because the situation where partitions are not laid like expected is difficult and awkward to handle
(Imagine a situation where first partition "sda1" is expected to be used as root partition, but it remains on disk as earlier boot partition making it way too small for purpose). For these reasons installers prefer "total control" over the disk and want the recipe
author to describe how all the OS used partitions are created from scratch.

The difficulty of this part is to come up with heuristics to size the partitions, especially when the hosts that you manage have different disk sizes. One hard-coded recipe will hardly work for this situation.

A "one-sizing-fits-all" solution for this is to configure the hard-wired disk layout in recipe with sizes fitting even the smallest disk of the host set. However this solution underutilizes the space on bigger disks and may not be satisfactory. Fixing the partition sizes - e.g. by re-sizing (typically growing) the partitons - after the OS install may be solution, but also leads to more scattered solution.




